
```{python}
import os
import sys
import json
import logging
from PIL import Image
from pdf2image import convert_from_path
import pytesseract
import pandas as pd
from elasticsearch import Elasticsearch

sys.path.append(os.path.dirname(os.getcwd()))

from scripts.pdfOCR import pdfOCR
from scripts.elasticStore import pdfMappingDict
from scripts.elasticStore import ElasticStore
import scripts.cons as cons
```

Need to install poppler and tesseract locally in windows:
* https://github.com/oschwartz10612/poppler-windows/releases/
* https://github.com/UB-Mannheim/tesseract/wiki

Load elastic credientials

```{python}
# load elastic credientials from .json file
with open(cons.elastic_docker_cred_fpath, "rb") as j:
    elastic_config = json.loads(j.read())
```

Set up python logging

```{python}
# set up logging
lgr = logging.getLogger()
lgr.setLevel(logging.INFO)
```

# PDF OCR

OCR the data from the image.

```{python}
# OCR pdf invoice
pytesseract.pytesseract.tesseract_cmd = cons.tesseract_exe_fpath
documents = pdfOCR(cons.pdf_fpath)
```

# Elastic Data Store

Connect to elastic search.

```{python}
# connect to elastic store
es = ElasticStore(
    http_auth=(elastic_config["user"], elastic_config["password"]), 
    elastic_docker_ca_crt_fpath=cons.elastic_docker_ca_crt_fpath,
    elastic_localhost_url=cons.elastic_localhost_url, 
    request_timeout=10
    )
```

List available indicies in elasticsearch.

```{python}
es.listIndices(index=f"*{cons.elastic_index_name}*")
```

Delete the pdf search elastic index.

```{python}
# delete index
es.deleteIndex(index=cons.elastic_index_name)
```

Create a new elastic index for pdf search.

```{python}
# create index
es.createIndex(index=cons.elastic_index_name, mappings=pdfMappingDict)
```

Get the mapping of a elastic index.

```{python}
es.getIndexMapping(index=cons.elastic_index_name)
```

Load documents into elastic index.

```{python}
es.loadIndex(index=cons.elastic_index_name, documents=documents)
```

Query document by id

```{python}
es.getDocumentfromId(index=cons.elastic_index_name, id='10111')
```